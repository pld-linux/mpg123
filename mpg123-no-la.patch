--- mpg123-1.1.0/src/module.c.orig	2008-01-15 03:27:32.000000000 +0100
+++ mpg123-1.1.0/src/module.c	2008-01-23 23:58:43.093716521 +0100
@@ -19,7 +19,7 @@
 #error Cannot build without LTDL library support
 #endif
 
-#define MODULE_FILE_SUFFIX		".la"
+#define MODULE_FILE_SUFFIX		".so"
 #define MODULE_SYMBOL_PREFIX 	"mpg123_"
 #define MODULE_SYMBOL_SUFFIX 	"_module_info"
 
@@ -77,12 +77,10 @@
 	size_t module_symbol_len = 0;
 	char *workdir = NULL;
 	char *moddir  = NULL;
-	workdir = get_the_cwd();
 	moddir  = get_module_dir();
-	if(workdir == NULL || moddir == NULL)
+	if(moddir == NULL)
 	{
-		error("Failure getting workdir or moddir!");
-		if(workdir != NULL) free(workdir);
+		error("Failure getting moddir!");
 		if(moddir  != NULL) free(moddir);
 		return NULL;
 	}
@@ -75,7 +75,6 @@
 	size_t module_path_len = 0;
 	char* module_symbol = NULL;
 	size_t module_symbol_len = 0;
-	char *workdir = NULL;
 	char *moddir  = NULL;
 	moddir  = get_module_dir();
 	if(moddir == NULL)
@@ -90,15 +87,14 @@
 	/* Initialize libltdl */
 	if (lt_dlinit()) error( "Failed to initialise libltdl" );
 
-	chdir(moddir);
 	/* Work out the path of the module to open */
-	module_path_len = strlen(type) + 1 + strlen(name) + strlen(MODULE_FILE_SUFFIX) + 1;
+	module_path_len = strlen(moddir) + 1 + strlen(type) + 1 + strlen(name) + strlen(MODULE_FILE_SUFFIX) + 1;
 	module_path = malloc( module_path_len );
 	if (module_path == NULL) {
 		error1( "Failed to allocate memory for module name: %s", strerror(errno) );
 		goto om_bad;
 	}
-	snprintf( module_path, module_path_len, "%s_%s%s", type, name, MODULE_FILE_SUFFIX );
+	snprintf( module_path, module_path_len, "%s/%s_%s%s", moddir, type, name, MODULE_FILE_SUFFIX );
 	/* Display the path of the module created */
 	debug1( "Module path: %s", module_path );
 
@@ -144,9 +140,7 @@
 om_bad:
 	module = NULL;
 om_end:
-	chdir(workdir);
 	free(moddir);
-	free(workdir);
 	return module;
 }
 
